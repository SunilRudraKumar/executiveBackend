const { parseEvents } = require('../src/utils/dataParser');

const mockData = [{ "receipt_handle": "AQEBU7Zj/vzCRAWJRTq0mRPC8w9aB1UUacI4cRshG/ZCYQoFnx++ZDDK4l2u4dFsZK1JH3lRWOxKGklZ4pqu9MyLy43T/l2lnFk8PvEc4DVlKUjYsetGt2TeHDCajnUG4JykUBmigvYYUc6XfaDQsQPiQEwPlIDWkm59gYrQFtVoSJD4c2Umnf+tbHjq8LediUhP3Ry2Dai/pWsceDTGbV2Ea6YHFDELt5k6Uzc2sSZUhcQGvEnCJ/1odyz0l7DW8ZrPuC732DiPZJSlND3mocuoeMbus1qfjzCauZPc/BUVvYkK/xcz4itFmZNH2/CbGKIn9TQk3w6KKDC8I8b9ULcBw9gMqCkg2XyD7JMb12HQ66Fl3r+v9zc7QnxfcwRdmT8WA0+zOzouemQEVhY0HnrEOGe3E/Cl31br//oioDeykqQttntVzrQ12thikMoxzHJDv0XaGh7HuvSARCP8AcHZVA==", "payload": { "stream_id": "a7bb368d-4acb-40c8-8e41-2f263a99da86", "stream_name": "EXECUTIVE_INN_Reservation", "event_id": "213bcf4d-5832-40c8-9a1f-41d039097470", "event_type": "RESERVATION", "property_id": "84626d8e-969c-4f06-b77a-a7a6dfc30cbf", "property_code": "LIV01", "type": "reservation", "reservation": { "id": "7de1cee8-b866-41b9-b37b-75ae32efdae7", "reservation_no": "LIV01AAB113", "booking_date": "2025-07-30T00:00:00.000Z", "original_booking_date": "2025-07-30T00:00:00.000Z", "booking_time": "2025-11-18T12:07:08.000Z", "booking_status": "CHECKED_IN", "source": "WEBSITE", "source_detail": { "name": "WEBSITE", "code": "WEBSITE" }, "market_segment": "WEBSITE", "market_code": "WEBSITE", "local_market_segment_code": "E", "local_market_segment_name": "E", "actual_check_in": "2025-12-09T21:39:11.000Z", "actual_check_in_local": "2025-12-09T14:39:11.000Z", "expected_check_out": "2025-07-31T11:00:00.000Z", "check_in_date": "2025-07-30T00:00:00.000Z", "check_out_date": "2025-07-31T00:00:00.000Z", "room_nights": 1, "room_number": "431", "old_room_number": "431", "room_count": 1, "room_type": "KS", "room_type_id": "70de6b85-cc4b-4cc1-9516-752d01f6468c", "rate_plan": "WEB", "rate_plan_detail": { "complimentary": false, "house_use": false, "day_use": false, "min_los": 1, "max_los": 365, "is_loyalty_rate_code": false, "group_enabled": false, "no_show_nights": 1, "is_company_rate_code": false }, "room_rate": 79.99, "status": "CHECKED_IN", "adult_count": 1, "child_count": 0, "guarantee_method_code": "PC", "guarantee_method_name": "PROPERTY GUARANTEE", "guaranteed": true, "tax_exempt": false, "receivable_flag": false, "username": "user_thinksimplicity", "created_username": "virdee_user", "transactions": [{ "id": "67ef0b06-34e0-4826-9aa2-427e9ebc3fc3", "date": "2025-07-30T00:00:00.000Z", "description": "CASH", "folio_name": "GENERAL", "folio_number": "LIV01AAB114", "folio_type": "GENERAL", "code": "CASH", "code_description": "CASH", "category": "credit", "currency": "USD", "amount": -96.44, "gross_amount": -96.44, "username": "user_thinksimplicity", "transaction_type": "PAYMENT", "receivable_flag": false }], "rate_details": [{ "rate_plan": "WEB", "rate_date": "2025-07-30T00:00:00.000Z", "currency": "USD", "rate_amount": 79.99, "room_type_code": "KS", "room_type_name": "KING SUITE", "user_name": "user_thinksimplicity", "total_taxes": 16.45, "commission_amount": 0 }], "previous_rate_details": [{ "rate_plan": "WEB", "rate_date": "2025-07-30T00:00:00.000Z", "currency": "USD", "rate_amount": 79.99, "room_type_code": "KS", "room_type_name": "KING SUITE", "user_name": "user_thinksimplicity", "total_taxes": 16.45, "commission_amount": 0 }], "guest_info": { "guest_id": "3408738c-8490-4cca-87d3-825b9e81cfbe", "first_name": "Vlad", "last_name": "Chertikhin", "phone": "+1234567890", "street": "Carollton", "city": "Dallas", "state": "TX", "country": "US", "email": "vlad@virdee.io", "travel_documents": { "PASSPORT": { "Last Name": "Richard", "First Name": "RickyTravelnopic" } } }, "additional_guest_info": [], "vehicles": [], "room_keys": [], "folios": [{ "name": "GENERAL", "folio_no": "LIV01AAB114", "folio_id": "49727a0d-555c-4425-aab4-b370e75a777b", "type": "GENERAL", "default": 1, "guest_id": "3408738c-8490-4cca-87d3-825b9e81cfbe", "paymentMethod": [{ "payment_type_name": "CASH", "payment_type_code": "CASH" }], "declined_payments": [], "accounting_balance": -96.44, "currency_label": "$" }], "add_ons": [], "booking_fee": [], "other_pet_count": 0, "cat_count": 0, "dog_count": 0, "check_in_agent": "user_thinksimplicity", "cancellation_policy": "24 HR CANCELLATION", "check_in_method": "FRONTDESK_WEB", "travel_agent": { "travel_agent_commission_amount": 0, "commission_percent": 0 }, "expected_check_out_utc": "2025-07-31T17:00:00.505Z", "loyalty_certificate": [], "check_in_date_with_property_time_utc": "2025-07-31 01:00:00", "check_out_date_with_property_time_utc": "2025-08-01 00:00:00", "child_age": [], "reservation_analytics": [], "reservation_rate_details": [{ "date": "2025-07-30T00:00:00.000Z", "amount": 79.99, "rate_type": "NON_COMPLIMENTARY", "display_amount": 79.99, "estimated_exclusive_taxes": 16.45, "estimated_inclusive_taxes": 0, "rate_detail_packages": [] }], "preferences": [], "booker_details": {} }, "timezone": "MST7MDT", "change_events": ["reservation_checked_in", "reservation_status_changed"], "event_time": "2025-12-09T21:40:42.494Z", "time_zone_offset": "UTC-07:00", "business_date": "2025-07-30T00:00:00.000Z", "source_name": "WEBSITE", "timestamp": "2025-12-09T21:39:12.072Z" } }]

const parsed = parseEvents(mockData);
console.log(JSON.stringify(parsed, null, 2));

if (parsed[0].data.guestName === 'Vlad Chertikhin' && parsed[0].data.roomNumber === '431') {
    console.log('TEST PASSED');
} else {
    console.error('TEST FAILED');
    process.exit(1);
}
